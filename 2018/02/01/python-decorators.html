
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149411100-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-149411100-2');
  </script>

  


  <meta charset="utf-8">
  <title>F***in' Decorators, How Do THEY Work?! - Maia McCormick</title>
  <meta name="author" content="Maia McCormick">

  
  <meta name="description" content="If you’ve been in Python-land for long, you’ve probably seen some @-sign thingies hovering (often mysteriously) above functions and class definitions &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://code.maiamccormick.com/2018/02/01/python-decorators.html">
  <link href="/favicon.png" rel="icon">
  <link href="/assets/css/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Maia McCormick" type="application/atom+xml">
  <script src="/assets/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./assets/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/assets/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Overlock+SC|Overlock:400,700|Merriweather:400,400italic,700,700italic' rel='stylesheet' type='text/css'>

<!-- Add fancyBox -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
  

</head>

<body   >
  <header role="banner"><div class="header-left">
  <hgroup>
  <h1><a href="/">Maia McCormick</a></h1>
  
  <div class="subtitle">
    <h2>Programmer, writer, nerd</h2>
  </div>
  
  </hgroup>
  
</div>

<div class="header-right">
  <ul class="main-navigation">
 <div> 
  <li><a href="/">blog</a></li></div>
  <div class="spacer"></div>

 <div> 
  <li><a href="/projects">projects</a></li></div>
  <div class="spacer"></div>

 <div> 
  <li><a href="/crosswords">crosswords</a></li></div>
  <div class="spacer"></div>

 <div> 
  <li><a href="/about">about</a></li></div>
</ul>

</div>
</header>
  <div id="main">
    <div id="content">
      <div id="thepost">
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">F***in' Decorators, How Do THEY Work?!</h1>
    
    
      <p class="meta">
        <span>










<span class="date"><time datetime="2018-02-01T13:16:46-05:00" pubdate data-updated="true">01 Feb 2018</time></span></span>
        <span>
<span class="categories">
  
    
    
      
      <span>
        <a class="category" href="/blog/categories/python">python</a>
      </span>
    
      
      <span>
        <a class="category" href="/blog/categories/tech">tech</a>
      </span>
    
  
  </ul>
</span>

</span>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you’ve been in Python-land for long, you’ve probably seen some <code class="language-plaintext highlighter-rouge">@</code>-sign thingies hovering (often mysteriously) above functions and class definitions, saying things like <code class="language-plaintext highlighter-rouge">@patch</code> or <code class="language-plaintext highlighter-rouge">@classmethod</code> or perhaps something even more obscure. Maybe you already know that these are called “decorators”. Maybe you’ve even used them, or written your own!</p>

<p>Even if you’ve done all that and still don’t quiiiite get what’s going on under the hood with decorators… don’t worry, my friend, you are not alone. Heck, <em>I’m</em> still not quite sure what goes on under the hood with decorators, but after a very productive afternoon of fiddling, I have a much better idea, and I’m here to share the fruits of that fiddling with you. Ready? Here we go:</p>

<p><strong>Decorators are callables called on callables that return a callable which then replaces the original callable.</strong></p>

<p>Got it?</p>

<p>…No?</p>

<p>…Yeah, okay, that’s fair. Let me try that again.</p>

<!--more-->
<h1 id="a-temporary-oversimplification">A Temporary Oversimplification</h1>

<p>I know I said “callable” up there before, but just for now, I’m going to simplify and instead of talking about “callables”, I’ll talk about “functions”. All functions are callables—i.e. “functions” are a subset of “callables”—and they tend to be the easiest case for people to wrap their heads around.</p>

<p><img src="/images/callables_venn_diagram.png" alt="Functions are a subset of callables" /></p>

<p>“Callables” can also be classes, or heck, most any object, if it’s got the appropriate set of behaviors. We’ll dig into that in a bit, but for now, let’s talk about decorators in terms of “functions”. With this simplification in mind, let me amend my definition above to make it maaarginally less confusing:</p>

<p><strong>A decorator is a function (<code class="language-plaintext highlighter-rouge">dec(…)</code>) called on a function (<code class="language-plaintext highlighter-rouge">fn(…)</code>) returning a function (<code class="language-plaintext highlighter-rouge">fn_decorated(…)</code>) which then replaces the original function:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">dec</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">(...):</span>
    <span class="p">...</span>

<span class="c1"># Is approximately equal to:
</span><span class="n">fn</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/decorators_flow_function.png" alt="Decorators are functions that modify functions" /></p>

<h1 id="how-decorators-are-applied">How Decorators are Applied</h1>

<p>Say we’ve got this function. It doesn’t do much, but it’s a nice little function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
</code></pre></div></div>

<p>But say that we’re so excited about that function that we want everyone to know when we call it, so we’re gonna sound a klaxon every time we do:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">times_two_with_alarm</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"WOOP! WOOP! WOOP!"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<p>Sure, that works. But what if we’ve got a BUNCH of functions that we’re really excited about, and we want to add this big ‘ol alarm (by which I mean “print statement”) to all of them? It’ll get repetitive to add that code everywhere; what if we just wrote a function to stick that print statement into our functions for us?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_alarm</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fn_with_alarm</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"WOOP! WOOP! WOOP!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fn_with_alarm</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">add_alarm</code> is a function that takes an argument <code class="language-plaintext highlighter-rouge">fn</code>, the function we want to add an alarm to: it then returns us a NEW function which does the following:
a) sound the alarm
b) invoke the original function we passed to it</p>

<p>In practice, then, we can achieve the same thing we achieved above like so:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">times_two_with_alarm</span> <span class="o">=</span> <span class="n">add_alarm</span><span class="p">(</span><span class="n">times_two</span><span class="p">)</span>
</code></pre></div></div>

<p>Because, remember, in Python, functions are first class objects; they can be passed around, passed as arguments, assigned, etc. In this case, <code class="language-plaintext highlighter-rouge">add_alarm</code> takes a function as an argument, and it <em>returns</em> a function (one that does whatever the original func. does, but this time with an alarm). We can then assign the output of <code class="language-plaintext highlighter-rouge">add_alarm</code>; so now, <code class="language-plaintext highlighter-rouge">times_two_with_alarm</code> is that new, modified function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">times_two_with_alarm</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">WOOP</span><span class="err">!</span> <span class="n">WOOP</span><span class="err">!</span> <span class="n">WOOP</span><span class="err">!</span>
<span class="o">&lt;</span> <span class="mi">10</span>
</code></pre></div></div>

<p>Heck, maybe we don’t want to keep track of a whole different function name, we just want that alarm to be baked into our <code class="language-plaintext highlighter-rouge">times_two</code> function. Well, we can do that too:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In case you forgot, here's how we defined this function...
</span><span class="k">def</span> <span class="nf">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>

<span class="c1"># Add the alarm to it!
</span><span class="n">times_two</span> <span class="o">=</span> <span class="n">add_alarm</span><span class="p">(</span><span class="n">times_two</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">times_two</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">WOOP</span><span class="err">!</span> <span class="n">WOOP</span><span class="err">!</span> <span class="n">WOOP</span><span class="err">!</span>
<span class="o">&lt;</span> <span class="mi">8</span>
</code></pre></div></div>

<h2 id="okay-but-like-you-havent-used-a-decorator-yet">Okay, But Like… You Haven’t Used a Decorator Yet…?</h2>

<p>Geez, I’m getting there! In fact, THIS is where decorators come in! If the above seems a little tiresome, we can use this shortcut:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">add_alarm</span>
<span class="k">def</span> <span class="nf">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">@decorator</code> syntax means basically what we said above: “define this function, but then run it through this other <code class="language-plaintext highlighter-rouge">decorator</code> function, and assign the result of that call (which, again, ought to be a function) back to the function I just defined.” This way, you can easily modify multiple functions in predictable<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> ways, and moreover, modify them <em>in place</em>; no need to keep track of both <code class="language-plaintext highlighter-rouge">times_two</code> and <code class="language-plaintext highlighter-rouge">times_two_with_alarm</code>, just update <code class="language-plaintext highlighter-rouge">times_two</code> to do the new thing.</p>

<h1 id="back-to-callables">Back to “Callables”</h1>

<p>So remember earlier when I waved a hand and said that we’d talk about decorators as “functions that manipulate functions”? Well it’s actually a bit gnarlier than that. Properly speaking, decorators are <strong>callables that manipulate callables</strong>, and as such, both decorators and the things they decorate <em>may</em> be functions, or they may be <em>random other stuff.</em></p>

<h2 id="whats-a-callable">What’s a “Callable”?</h2>

<p>A <strong>callable</strong> is <strong>anything that you can</strong> <strong><em>call</em></strong>—i.e. anything that you can stick a <code class="language-plaintext highlighter-rouge">()</code> after (with maybe some arguments inside) and have something happen. A callable may be a <strong>function</strong> (<code class="language-plaintext highlighter-rouge">my_func(...)</code>) or a <strong>class</strong> (<code class="language-plaintext highlighter-rouge">MyClass(...)</code><sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>), or (as helpful as this definition is) any <strong>object</strong>, as long as it can be… well, called. Some things that are NOT callable include strings, ints, lists, etc.:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="s">"hello"</span><span class="p">()</span>
<span class="o">&lt;</span> <span class="nb">TypeError</span><span class="p">:</span> <span class="s">'str'</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">callable</span>
</code></pre></div></div>

<p>So then, to re-visit our original definition of a decorator, taking away our initial oversimplification: <strong>decorators are callables that manipulate callables (and then replace the original thing with the modified thing).</strong></p>

<p><img src="/images/decorators_flow_callable.png" alt="Decorators are callables that modify callables" /></p>

<p>We’ve already talked about decorators as functions being used to modify functions. But since callables can be either functions or classes (…or objects, but we’ll ignore that for now), let’s talk about some other cases.</p>

<h2 id="decorating-a-class-with-a-function">Decorating a Class with a Function</h2>

<p>What if we just got really excited about a bunch of classes, and wanted to announce to the world whenever we made a new instance of one? It might look something like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">announce_new_instance</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">make_new_instance_with_announcement</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Making a thing!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">make_new_instance_with_announcement</span>

<span class="o">@</span><span class="n">announce_new_instance</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>

<span class="o">&gt;</span> <span class="n">MyClass</span><span class="p">(</span><span class="s">'bar'</span><span class="p">)</span>
<span class="n">Making</span> <span class="n">a</span> <span class="n">thing</span><span class="err">!</span>
<span class="o">&lt;</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="p">.</span><span class="n">MyClass</span> <span class="n">at</span> <span class="mh">0x10fd84b70</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Recall that <code class="language-plaintext highlighter-rouge">MyClass</code> is a <em>callable</em>—<code class="language-plaintext highlighter-rouge">MyClass()</code> means, “make me a new MyClass instance!”—and so we can treat it just like any other thing that can be called, and even treat it like the function from our first example. In this case, under the hood, we’re replacing <code class="language-plaintext highlighter-rouge">MyClass</code> (the function-like thing that, when called, makes a new instance) with <code class="language-plaintext highlighter-rouge">make_new_instance_with_announcement</code>, which makes its announcement and <em>then</em> kicks off making a new instance. (In the context of the decorator above, <code class="language-plaintext highlighter-rouge">cls</code> represents the class you passed in, i.e. the class you’re decorating; so here, it’s <code class="language-plaintext highlighter-rouge">MyClass</code>, thus <code class="language-plaintext highlighter-rouge">cls()</code> is the same as <code class="language-plaintext highlighter-rouge">MyClass()</code>.<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup></p>

<h2 id="classes-as-decorators">Classes as Decorators</h2>

<p>This one bends my brain, but you can totally use a class as a decorator! Because as we discusssed (say it with me), <em>classes are callables too</em>. A call to <code class="language-plaintext highlighter-rouge">MyClass(*args, **kwargs)</code> eventually calls out to <code class="language-plaintext highlighter-rouge">MyClass.__init__(self, *args, **kwargs)</code> (and does some other magic such that at the end of it all, an instance is returned back). There are probably other rad things you can do with classes-as-decorators, but the pattern I’ve seen most often (in all three hours of looking into this) is this one:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DecoratorClass</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Look how decorated!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="o">@</span><span class="n">DecoratorClass</span>
<span class="k">def</span> <span class="nf">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>

<span class="o">&gt;</span> <span class="n">times_two</span><span class="p">(</span><span class="mi">41</span><span class="p">)</span>
<span class="n">Look</span> <span class="n">how</span> <span class="n">decorated</span><span class="err">!</span>
<span class="o">&lt;</span> <span class="mi">82</span>
</code></pre></div></div>

<p>Oh man, weird, right? <code class="language-plaintext highlighter-rouge">DecoratorClass</code> is a class that takes a function (<code class="language-plaintext highlighter-rouge">fn</code>) as an initialization argument and hangs onto it. And recall that we replace the function-to-be-decorated with the result of a call to <code class="language-plaintext highlighter-rouge">decorator</code>, thus the above is equivalent to:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">times_two</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>

<span class="n">times_two</span> <span class="o">=</span> <span class="n">DecoratorClass</span><span class="p">(</span><span class="n">times_two</span><span class="p">)</span>
</code></pre></div></div>

<p>That is, the new <code class="language-plaintext highlighter-rouge">times_two</code> is an <em>instance</em> of <code class="language-plaintext highlighter-rouge">DecoratorClass</code>?! What?!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">times_two</span>
<span class="o">&lt;</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="p">.</span><span class="n">DecoratorClass</span> <span class="n">at</span> <span class="mh">0x109b867b8</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>But the point of decorators is that we don’t really <em>care</em> what <code class="language-plaintext highlighter-rouge">times_two</code> is, we just want it to do what we expect when we call it. Thus, we need an instance of <code class="language-plaintext highlighter-rouge">DecoratorClass</code> to actually DO stuff when you stick <code class="language-plaintext highlighter-rouge">(…)</code> at the end. That’s where the <code class="language-plaintext highlighter-rouge">__call__</code> method we defined earlier comes in.</p>

<h3 id="tangent-__call__">Tangent: <code class="language-plaintext highlighter-rouge">__call__</code></h3>

<p>We can make an object (i.e. an instance of a class) callable using the magic <code class="language-plaintext highlighter-rouge">__call__</code> method, like so:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Callable</span><span class="p">():</span>
    <span class="c1"># defining the __call__ method on an INSTANCE of this class
</span>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"you called me!"</span>

<span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">()</span>

<span class="o">&gt;</span> <span class="n">c</span><span class="p">()</span>
<span class="o">&lt;</span> <span class="s">"you called me!"</span>

<span class="c1"># Contrast with...
</span><span class="k">class</span> <span class="nc">NotCallable</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="o">&gt;</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">NotCallable</span><span class="p">()</span>

<span class="o">&gt;</span> <span class="n">nc</span><span class="p">()</span>
<span class="o">&lt;</span> <span class="nb">TypeError</span><span class="p">:</span> <span class="s">'NotCallable'</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">callable</span>
</code></pre></div></div>

<h3 id="back-to-decoratorclass">Back to <code class="language-plaintext highlighter-rouge">DecoratorClass</code></h3>
<p>So we’ve got a <code class="language-plaintext highlighter-rouge">DecoratorClass</code> that takes in a function and hangs onto it, and when we define the magic method  <code class="language-plaintext highlighter-rouge">__call__</code>, we’re defining what happens when we stick <code class="language-plaintext highlighter-rouge">(...)</code> on the end of an instance of this class—we call the function that we passed in in the first place:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">DecoratorClass</span><span class="p">(</span><span class="n">times_two</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">instance</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># i.e. DecoratorClass.__call__(5)
</span><span class="n">Look</span> <span class="n">how</span> <span class="n">decorated</span><span class="err">!</span>
<span class="o">&lt;</span> <span class="mi">10</span>
</code></pre></div></div>

<p>So after all that decorator magic, we’ve replaced <code class="language-plaintext highlighter-rouge">times_two</code> with an instance of <code class="language-plaintext highlighter-rouge">DecoratorClass</code>, right? But as we just saw above, we can call that instance like we would call any other function; thus <code class="language-plaintext highlighter-rouge">times_two</code> can still be called like normal, and in all respects treated as a normal function—but now it has some shiny extra functionality added via our decorator.</p>

<h2 id="okay-but-why-would-you-want-to-use-a-class-as-a-decorator">Okay, But Why Would You WANT to Use a Class as a Decorator?</h2>

<p>That’s a great question. There are probably lots of fascinating answers. At this present moment, I only have two: “to store state” and “because you can”. Since I’ve already covered the latter in quite a bit of detail, let’s turn to the former, i.e., a halfway plausible case in which you might want to use a class as a decorator. (I’m sure there are other reasonable ways to store state on a function, as well as other compelling reasons to use classes as decorators, but let’s just go with this for now.)</p>

<p>Unlike functions, which are (generally) one-and-done, classes allow you to store state.<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup> How might you use this in a decorator context? Consider something like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">countcalls</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">CALLS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">CALLS</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"This func. has been called {} time(s)"</span><span class="p">.</span>
            <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">CALLS</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="o">@</span><span class="n">countcalls</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"hello world"</span>

<span class="o">&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="n">This</span> <span class="n">func</span><span class="p">.</span> <span class="n">has</span> <span class="n">been</span> <span class="n">called</span> <span class="mi">1</span> <span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="s">"hello world"</span>

<span class="o">&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="n">This</span> <span class="n">func</span><span class="p">.</span> <span class="n">has</span> <span class="n">been</span> <span class="n">called</span> <span class="mi">2</span> <span class="n">time</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="s">"hello world"</span>
</code></pre></div></div>

<p>And heck, why not go for broke and use a class to decorate a class?!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">countinits</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">cls</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">INITS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">INITS</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"You've made {} of this class"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">INITS</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="o">@</span><span class="n">countinits</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="o">&gt;</span> <span class="n">inst1</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">You</span><span class="s">'ve made 1 of this class

&gt; inst2 = MyClass()
You'</span><span class="n">ve</span> <span class="n">made</span> <span class="mi">2</span> <span class="n">of</span> <span class="n">this</span> <span class="k">class</span>
</code></pre></div></div>

<p>The above example looks a little gnarly, but remember that <code class="language-plaintext highlighter-rouge">cls</code> here is <code class="language-plaintext highlighter-rouge">MyClass</code> which is a callable (that makes and returns a new <code class="language-plaintext highlighter-rouge">MyClass</code> instance), and remember how the <code class="language-plaintext highlighter-rouge">@decorator</code> syntax is applied, and you can piece together precisely what dark magic is happening here.</p>

<h1 id="awesome-wait-what">Awesome! …Wait, What?</h1>

<p>Yeah, I know, a lot of things just went down. To summarize:</p>

<ol>
  <li>you can <em>decorate</em> any callable—be it a function, a class, or any callable object.</li>
  <li>a <em>decorator</em>—the <code class="language-plaintext highlighter-rouge">@something</code> thing—is a callable (function, class, etc.) that takes as an argument the thing you’re decorating and returns another callable that preserves the original functionality but adding something new</li>
  <li>the type of callable is irrelevant. Functions can decorate functions, or classes, or objects. Classes can decorate functions, or classes, or objects. Basically, anything goes.</li>
</ol>

<p>There are lots of other resources on the interwebs about what sort of stuff you might want to use decorators for—and heck, I might write a blogpost about some of them in future—but I hope this is an illuminating overview of just what the heck decorators <em>are</em> and how they work. As always, feel free to reach out with any questions! A big thank you to all the excellent folks who beta-read/edited this post: <a href="http://happyspork.com/">Ben Anderman</a>, <a href="https://github.com/cappachu">Codanda Appachu</a>, <a href="http://antha.site/">Sam Auciello</a>, and <a href="https://alexburka.com/">Alex Burka</a>.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>…except that decorators as described here can potentially do weird things to doc strings and other function attributes. This is one of the reasons that many folks use <a href="https://docs.python.org/3/library/functools.html#functools.wraps"><code class="language-plaintext highlighter-rouge">functools.wraps</code></a> when decorating things: it copies over most (though not all 😞) of the original functions’     hidden attributes to the new, wrapped function. Hat tip to <a href="https://github.com/cappachu">Codanda Appachu</a> for reminding me of this. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p><code class="language-plaintext highlighter-rouge">MyClass(...)</code>, of course, being shorthand for <code class="language-plaintext highlighter-rouge">MyClass.__init__(...)</code>. (That’s totally an oversimplification; <code class="language-plaintext highlighter-rouge">MyClass(...)</code> is <em>actually</em> shorthand for <code class="language-plaintext highlighter-rouge">MyClass.__new__(cls)</code>, which does a bunch of stuff, including call <code class="language-plaintext highlighter-rouge">__init__</code> on the newly made <code class="language-plaintext highlighter-rouge">MyClass</code> instance… but sufice it to say that when I call <code class="language-plaintext highlighter-rouge">MyClass(...)</code> I expect some stuff to happen, including a call to <code class="language-plaintext highlighter-rouge">MyClass.__init__</code>, and to eventually get back a new instance of that class.) <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>Note that since <code class="language-plaintext highlighter-rouge">MyClass(...)</code> is baaasically shorthand for <code class="language-plaintext highlighter-rouge">MyClass.__init__(...)</code> (see above), and so you can achieve a pretty similar effect by decorating the <code class="language-plaintext highlighter-rouge">__init__</code>  method. The thing passed into <code class="language-plaintext highlighter-rouge">announce_new_instance</code> to be transformed will be different, but the new function will execute in just about the same way. <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p>Hat tip to <a href="http://jayantj.github.io/">Jayant Jain</a>, who pointed out an error I made in the original version of this blogpost. (Yes, if you really wanted to, you could store state on a function as well, cuz it’s Python and everything is an object, including functions. For instance, I could totally set <code class="language-plaintext highlighter-rouge">my_func.some_value = "hello"</code>. However, it’s awkward and unidiomatic. So like, go ahead and do that if you want, but it’s kinda weird, and really it just makes more sense to use classes.) <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>


  <footer>
    <p class="meta">
      
<span class="byline author vcard">Posted by <span class="fn">Maia McCormick</span></span>

      










<span class="date"><time datetime="2018-02-01T13:16:46-05:00" pubdate data-updated="true">01 Feb 2018</time></span>
      
<span class="categories">
  
    
    
      
      <span>
        <a class="category" href="/blog/categories/python">python</a>
      </span>
    
      
      <span>
        <a class="category" href="/blog/categories/tech">tech</a>
      </span>
    
  
  </ul>
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2017/06/17/what-are-interfaces.html" title="Previous Post: What Are Interfaces?">&laquo; What Are Interfaces?</a>
      
      
        <a class="basic-alignment right" href="/2018/03/25/interview-prep.html" title="Next Post: Preparing for Technical Interviews">Preparing for Technical Interviews &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  </section>
  <ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" title="subscribe via RSS"><img src="/images/rss.png"></a></li>
  </ul>
    
</section>

<img src = "/images/headshot.jpg">
<section>
  <a href="/blog/archives/"><h1>Recent Posts</h1></a>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2021/06/27/job-hunting.html">Job Hunting While Day-Jobbing</a>
      </li>
    
      <li class="post">
        <a href="/2020/02/27/amsterdam-recommendations.html">Amsterdam Recommendations</a>
      </li>
    
      <li class="post">
        <a href="/2018/05/29/how-windmill-prepped-for-gothamgo.html">How Windmill Prepped for GothamGo</a>
      </li>
    
      <li class="post">
        <a href="/2018/03/25/interview-prep.html">Preparing for Technical Interviews</a>
      </li>
    
      <li class="post">
        <a href="/2018/02/01/python-decorators.html">F***in' Decorators, How Do THEY Work?!</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Recent Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <div class="center">
    <a href="https://github.com/maiamcc">@maiamcc</a> on GitHub
  </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/assets/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        // HACK: repos to skip, i.e. not show in sidebar (ideally would pull in this
        //   list from config.yml but it's not worth it to figure out right now #yolo)
        var repos_to_skip = new Set([
          'ghsite_source',
          'maiamcc.github.io',
          'contrasite_source',
          'testsite',
          'bigchaos',
          'musica-vera'
        ]);


        github.showRepos({
            user: 'maiamcc',
            count: 10,
            skip_forks: false,
            repos_to_skip: repos_to_skip,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/assets/javascripts/github.js" type="text/javascript"> </script>
</section>



</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
	<div class="rc-scout"></div>
</p>
<p>
  Copyright &copy; 2021 - Maia McCormick - maia [dot] mcc [at] gmail [dot] com
</p>

<p>
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/fapper/classic-martinb">classic-martinb</a> theme</span>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'maia-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://code.maiamccormick.com/2018/02/01/python-decorators.html';
        var disqus_url = 'https://code.maiamccormick.com/2018/02/01/python-decorators.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>










<script async defer src="https://www.recurse-scout.com/loader.js?t=909b1e858cb2f5a7df2312d2f522aabf"></script>

</body>
</html>
