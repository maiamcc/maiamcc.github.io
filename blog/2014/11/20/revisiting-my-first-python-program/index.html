<hr />

<p>layout: post
title: &ldquo;Revisiting My First Python Program&rdquo;
date: 2014-11-20 20:36:26 -0500
comments: true</p>

<h2>categories: [Hacker School, code review]</h2>

<p>Back in mid-July, I started at Hacker School, wide-eyed and green and totally freaked out. With only a little bit of Javascript under my belt(and a basically negligible amount of Java, so we&rsquo;re not even counting that), I decided to teach myself Python, slogged halfway through Zed Shaw&rsquo;s <em>Learn Python the Hard Way</em>, then went off to go build something, because I work best by getting my hands dirty. For my first Python project, I wrote <a href="//github.com/maiamcc/studentchooser">studentchooser</a>, a little command-line app request by a teacher friend of mine, who wanted a fair way to call on her students at random (for putting homework problems on the board, etc.). The idea was that, once a student had been selected, it was <em>less</em> likely that they would be selected again, but not impossible&mdash;the chance of them being picked subsequently would go down, but they would still be in the running.</p>

<p>So, I made a program to do that! You store a list of students for a given class period in what I called the <code>roster</code> (just a dictionary of students). Each <code>Student</code> object keeps track of the number of times it has been selected and its probability of being selected in the next round, as well as whether or not the student is absent.<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> It took me a little more than a week to finish, as I was still muddling through Python as I went, and at the end, I had a working final product! A rough one, but a working one! And then I went off on my merry way, doing more and varied projects and slowly building up my Python chops, getting code review, etc. Somewhere along the way, so gradually I didn&rsquo;t even realize it, I began to feel competent, like with enough time to think and maybe a little Googling, I could Python my way out of most problems that were thrown at me. And so today, back at Hacker School for Alumni Thursday and itching to write some code (because I&rsquo;ve been up to my neck in web work for the past few weeks), I opted for a blast from the past, and dived into my very first Python project to poke around, refactor, clean up, and chronicle what I found and what I had learned in the past four months. Here are some findings, accomplishments, and reflections.<!--more--></p>

<h4>Little things I changed</h4>

<p>There were a handful of little things that now strike me as really silly that I changed straight off. Stuff like the realization that text files don&rsquo;t actually need an extension (<code>.txt</code> or otherwise), or that instead of <code>myfile = open("foo.txt", "r"); contents = myfile.read(); myfile.close()</code> I could do the whole thing more cleanly and more efficiently with <code>with open("foo.txt") as myfile:</code>. Similarly, I found loads of places where a little more specificity in variable naming would have made the code hugely easier to read. So given something like, say, <code>for item in roster_list</code>, I changed it to <code>for roster_name in roster_list</code>.</p>

<h4>Gratuitous, &ldquo;useless&rdquo; comments</h4>

<p>There were comments EVERYWHERE. Like seriously, look at the code sample below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="sd">&quot;&quot;&quot;Load a roster from file.&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Boolean saying that this is NOT a new roster</span>
</span><span class='line'>    <span class="c"># i.e. when the program saves data, it will NOT edit the &quot;config&quot; file</span>
</span><span class='line'><span class="k">global</span> <span class="n">new_roster</span>
</span><span class='line'><span class="n">new_roster</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'><span class="c"># make list of all rosters in config file</span>
</span><span class='line'><span class="n">roster_list</span> <span class="o">=</span> <span class="n">get_all_rosters</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># if list is empty, make a new roster instead</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;No rosters available to load. Make a new one instead.&quot;</span>
</span><span class='line'>    <span class="n">make_new_roster</span><span class="p">()</span>
</span><span class='line'><span class="k">else</span><span class="p">:</span> <span class="c"># if config file contains at least one roster to load...</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Which roster would you like to load? Enter a number.&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># print a list of available rosters from config file</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">roster_list</span><span class="p">:</span>
</span><span class='line'>        <span class="n">item_index</span> <span class="o">=</span> <span class="n">roster_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">pretty_name</span> <span class="o">=</span> <span class="n">get_pretty_name</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c"># (name of the file w/o the file extension)</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%d</span><span class="s">. </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item_index</span><span class="p">,</span> <span class="n">pretty_name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="n">answer</span> <span class="o">=</span> <span class="n">ask</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># if possible, turn answer from a string into an int.</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">answer_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span class='line'>            <span class="n">answer_int</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'>        <span class="c"># if the answer is an int. in the range of # items in the list...</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">answer_int</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span class='line'>            <span class="n">index</span> <span class="o">=</span> <span class="n">answer_int</span> <span class="o">-</span> <span class="mi">1</span> <span class="c"># (b/c list as displayed is 1-indexed)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c"># save the given filename as the &#39;current file&#39;</span>
</span><span class='line'>            <span class="k">global</span> <span class="n">current_file</span>
</span><span class='line'>            <span class="n">current_file</span> <span class="o">=</span> <span class="n">roster_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'>            <span class="k">print</span> <span class="s">&quot;File to load:&quot;</span><span class="p">,</span> <span class="n">current_file</span>
</span><span class='line'>
</span><span class='line'>            <span class="c"># populate the roster using the data in the selected file</span>
</span><span class='line'>            <span class="n">populate_roster</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c"># returns name of the class (= name of the file) for display</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">get_pretty_name</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span> <span class="c"># if user input isn&#39;t in range or isn&#39;t an integer</span>
</span><span class='line'>            <span class="k">print</span> <span class="s">&quot;Sorry, I didn&#39;t get that. Try again.&quot;</span> <span class="c"># run the loop again</span>
</span></code></pre></td></tr></table></div></figure>


<p>This comments-every-step-of-the-way thing pops up again and again in studentchooser, and looking at the code now, it seems pretty silly, because I can tell just by looking what most of these lines do&mdash;or at least, I can after rewriting it a bit so that variable names are intuitive, code is readable, etc. So I took a lot of these comments out of the refactored version, but I think it&rsquo;s really important to remember why I put them in in the first place. When I was first writing this code, it wasn&rsquo;t gratuitous, it was <em>super helpful</em> to know step by step exactly what was happening in my code, and to write it down so I couldn&rsquo;t get away with fudging that understanding. This is actually one of the few things I really took with me from <em>Learn Python the Hard Way</em> (see for instance <a href="//learnpythonthehardway.org/book/ex6.html#study-drills">these study drills</a>&mdash;that explaining your code in English line by line is a <em>great</em> tool for understanding and internalizing it! This is something I still keep in my toolbox for unknown/particularly tricky bits of code.</p>

<h4>Now I know better&hellip;</h4>

<p>This project has a) no tests, which make it a giant pain to refactor; b) haphazard architecture, because I was adding features as they occurred to me and I didn&rsquo;t go in with an overarching plan, and so variable names are unclear, patterns of work are inconsistent, bits of the code are held together with tape and bubble gum, etc., and c) poor readability, due in part to the inconsistent naming schemes, in part to the fact that I wasn&rsquo;t prioritizing readability and didn&rsquo;t know how to code for it, and in part to the fact that I thought gratuitous commenting would make up for hard-to-read code. Now I know better, or at least I hope I do. (When I&rsquo;m not lazy,) I write tests for my projects; I outline my projects ahead of time and plan for the features I may add in the future so the architecture stays coherent and I don&rsquo;t have to refactor halfway through (hopefully); and I strive for readability in my code itself (and don&rsquo;t rely on gratuitous commenting to do that work for me).</p>

<h4>New tools, new sensibilities</h4>

<p>I first learned about list comprehension when <a href="//ballingt.com/">Tom</a> code-reviewed this project for me, though I didn&rsquo;t really understand what they were until much later&mdash;I initially thought they were something cool you could do in a return statement, which now makes me laugh. But now that I actually understand list comprehensions and a bunch of other handy tricks, I can write much tighter, more efficient code. What used to be this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_all_rosters</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;&quot;Return a list of all of the roster filenames in the config file.&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="n">all_rosters_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span><span class='line'>    <span class="n">all_rosters_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_rosters_file</span><span class="p">:</span>
</span><span class='line'>        <span class="n">all_rosters_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span class='line'>    <span class="n">all_rosters_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
</span><span class='line'>    <span class="n">all_rosters_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">all_rosters_list</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;is now this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_all_rosters</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;&quot;Return a list of all of the roster filenames in the config file.&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">all_rosters_file</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">all_rosters_file</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code is more compact not only because of the list comprehension (did I mention that list comprehensions are <em>awesome</em>?) but also because I smooshed the sorting into the same line as the list-making. There are other cases where before, I make a list, joined it into a string, and returned the string, but now, I return-a-join-this-list-into-a-string-please-thx-bai, all in one line. The more comfortable I get with Python, the less I need to separate things out and the more able I am to smush things together into fewer lines while still knowing what&rsquo;s going on.</p>

<h4>Global variables, global variables everywhere!</h4>

<p>By far the biggest pain in the neck about this whole program was keeping track of the global variables. I had a few of them floating around: a roster where I stored all of my students, a list of the students (because for some reason I needed to keep a separate list instead of just extracting it from the roster), the filename under which this roster was stored, a boolean telling me whether this was a new roster or not&hellip; And so every time there was a function that needed to interact with and modify, say, the roster, it had to go look for this global variable called <code>roster</code> (I guess because I didn&rsquo;t think to pass in the roster as an argument).</p>

<p>The solution to my dilemna? Classes!</p>

<p><img src="/images/stayclassy.jpg" alt="&quot;Stay classy, San Diego!&quot;" /></p>

<p>I made a <code>Roster</code> class so that methods like <code>choose()</code>, instead of finding the global variable <code>roster</code>, accessing it, changing it, and sending it back into the ether to live its global-variable life, would instead be called as <code>myroster.choose()</code> and act on that specific instance of <code>Roster</code>, and there would be no confusion as to what the method was accessing/modifying. This refactoring solved another handful of problems, because I could decree that file names would be the same as roster names, and so <code>myroster.name</code> would also keep track of our current file name; similarly, <code>myroster.new</code> would keep track of whether or not this was a newly created roster. Basically, the <code>Roster</code> class let me get rid of all of my global variables, and now all I have to keep track of is the <code>current_roster</code> object. (Also, now I know better than to make it a global variable; if there are functions that need to access it&mdash;which I have tried to minimize&mdash;I pass it to that function as an argument.) Check out a high-level view of my <code>Roster</code> class to see all the functions contained therein:</p>

<p><img src="/images/roster_class.png" alt="Can't see this? Bummer, I guess you have to go check out my github." /></p>

<h4>In conclusion</h4>

<p>I refactored some code and had a total blast from the past. I decided to see what I could improve without changing any of the functionality, just the code, and I cut my program from 536 lines down to 432, and to 399 if we remove vestigial testing functions. That&rsquo;s about a 20% reduction in length! I also convinced myself that I <em>do</em>, in fact, know how to write Python, and checked in with myself about how far I&rsquo;ve come in the last four months. I obviously have loads more to learn&mdash;and this exercise reminded me of some of the helpful strategies in my toolbox, like temporarily over-commenting to wrap my head around whacky and confusing code.</p>

<p>So, after reflection, my advice to new programmers who are jumping in the deep end like I did? Get your hands dirty. Write lots of code, without necessarily caring about what the finished product looks like&mdash;you&rsquo;ll learn so much more from finishing it and fixing it later than you will from agonizing over it. Get code review and pair with people who know more than you do&mdash;it&rsquo;s how you pick up the stuff that makes you a better programmer. But mostly, don&rsquo;t panic!</p>

<p>(This is a blog-ified version of a Hacker School Thursday Talk presentation given on 11/20/14.)</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>There are some slightly more finicky mechanics going on that you can read about in the README on github if you&rsquo;re really curious, but this is all that&rsquo;s relevant for this post.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

